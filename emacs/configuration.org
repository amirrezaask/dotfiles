* Amirreza Emacs Ditribution
** Debug On error
#+BEGIN_SRC emacs-lisp
(setq debug-on-error 1)
#+END_SRC
** My Personal Info
#+BEGIN_SRC emacs-lisp
(setq user-full-name    "Amirreza Askarpour"
      user-mail-address "amirrezaask@protonmail.com")

#+END_SRC
** Basic package manager and use-package setup
*** Store current time for further benchmark
#+BEGIN_SRC emacs-lisp
(setq start (float-time)) ;; to measure emacs startup time
#+END_SRC
*** Setup Emacs Package manager and add repos
#+BEGIN_SRC emacs-lisp
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/"))
(package-initialize) ;; initialize emacs built-in package manager
(when (not package-archive-contents)
    (package-refresh-contents))

#+END_SRC

*** Install use-package
#+BEGIN_SRC emacs-lisp
  (package-install 'use-package)
  (setq use-package-always-ensure t)
#+END_SRC
** Some Basic Emacs setup
*** setup custom file so emacs won't mess with init.el
#+BEGIN_SRC emacs-lisp
(setq custom-file "~/.__custom.el")
#+END_SRC
*** Turn off emacs annoying and ugly startup page
#+BEGIN_SRC emacs-lisp
(setq inhibit-splash-screen 0) ;; turn off emacs annoying startup page.
#+END_SRC
*** Turn off Emacs annoying ~ files
#+BEGIN_SRC emacs-lisp
(setq make-backup-files nil) ;; turn off emacs annoying ~ files
#+END_SRC
*** Turn Emacs # files
#+BEGIN_SRC emacs-lisp
(setq create-lockfiles nil) ;; turn off emacs annoying # files
#+END_SRC

*** Turn Emacs annoying beeps
#+BEGIN_SRC emacs-lisp
(setq ring-bell-function 'ignore)
#+END_SRC
*** Turn off emacs GUI toolbar, menubar and scrollbar
#+BEGIN_SRC emacs-lisp
(tool-bar-mode 0) ;; turn off emacs GUI toolbar
(scroll-bar-mode 0) ;; turn off emacs GUI scrollbar
(menu-bar-mode 0) ;; turn emacs GUI menubar
#+END_SRC
*** Define alias for emacs question
#+BEGIN_SRC emacs-lisp
(defalias 'yes-or-no-p 'y-or-n-p) ;; instead of yes-or-no ask y-or-no, only for convinience
#+END_SRC
*** Enable Line numbers globally
#+BEGIN_SRC emacs-lisp
(global-linum-mode t) ;; enable line numbers
#+END_SRC

*** Ask for confirmation before emacs quiting
#+BEGIN_SRC emacs-lisp
(setq confirm-kill-emacs 'y-or-n-p)
#+END_SRC
** Some UI Enhancements and Theme setup
*** Disable GUI Pop Up
#+BEGIN_SRC emacs-lisp
(setq use-dialog-box nil)
#+END_SRC
*** Prettify Lisp codes
#+BEGIN_SRC emacs-lisp
(defconst lisp--prettify-symbols-alist
  '(("lambda"  . ?Î»))) ;; shows lambda word as the symbol
(global-prettify-symbols-mode 1)
#+END_SRC
*** Font setup
    
#+BEGIN_SRC emacs-lisp
(defvar font-family "Jetbrains Mono" "Font to use for Emacs.")
(defvar font-size 11 "Font size for Emacs.")
(add-to-list 'default-frame-alist (cons 'font (format "%s-%d" font-family font-size)))
(set-face-attribute 'default nil
		    :family font-family
		    :height (* 10 font-size))
#+END_SRC
*** Themes Setup
#+BEGIN_SRC emacs-lisp
  (setq custom-safe-themes t)
  (use-package dracula-theme  :defer t)
  (use-package solarized-theme  :defer t)
  (use-package spacemacs-theme  :defer t)
  (use-package doom-themes  :defer t)
  (defvar dark-theme 'doom-one "Default dark theme to use")
  (defvar light-theme 'doom-one-light "Default light theme to use")
  (defvar current-mode 0 "Current mode 0=> dark 1=>light")
  (defun light-mode ()
    "Light it up."
    (interactive)
    (load-theme light-theme t))
  (defun dark-mode ()
    "Ascend to darkness"
    (interactive)
    (load-theme dark-theme t))
  (defun toggle-color-mode ()
    (interactive)
    (if (= current-mode 0) (progn (dark-mode) (setq current-mode 1)) (progn (light-mode) (setq current-mode 0)))
  )
  (global-set-key (kbd "C-x t") 'toggle-color-mode)
  ;; (light-mode)
  (dark-mode)
#+END_SRC
*** Show emojis
#+BEGIN_SRC emacs-lisp
(use-package emojify  :config (emojify-mode 1))
#+END_SRC
** Ivy
#+BEGIN_SRC emacs-lisp
  (use-package swiper  :bind (("C-s" . swiper)))
  (use-package counsel  :bind (("M-x" . counsel-M-x) ("C-x C-f" . counsel-find-file) ("C-x b" . ivy-switch-buffer)))
#+END_SRC
** Org mode
#+BEGIN_SRC emacs-lisp
  (use-package org-bullets  :defer t :commands (org-bullets-mode) :init (add-hook 'org-mode-hook #'org-bullets-mode))
  (use-package htmlize  :defer t)
#+END_SRC
** Keybindings
*** Some shorter keychords for most used functions
#+BEGIN_SRC emacs-lisp
  (global-set-key (kbd "C-o") 'other-window)
  (global-set-key (kbd "C-0") 'delete-window)
  (global-set-key (kbd "C-1") 'delete-other-windows)
  (global-set-key (kbd "C-2") 'split-window-below)
  (global-set-key (kbd "C-3") 'split-window-right)
  (global-set-key (kbd "C-r") 'replace-string)
#+END_SRC
*** Guru Mode ( Only emacs shall remain )
#+BEGIN_SRC emacs-lisp
(use-package guru-mode  :config (guru-global-mode 1))
#+END_SRC
*** Which key helps us when we only remember part of a keybinding
#+BEGIN_SRC emacs-lisp
(use-package which-key  :init (setq echo-keystrokes 0.3) :config (which-key-mode 1))
#+END_SRC
** Editor setup
*** Add Support for json, yaml and markdown
#+BEGIN_SRC emacs-lisp
(use-package json-mode  :mode "\\.json\\'"
  :config
  (add-hook 'before-save-hook 'json-mode-beautify))
(use-package markdown-mode  :mode "\\.md\\'")
(use-package yaml-mode  :mode "\\.ya?ml\\'")
#+END_SRC
*** Whitespace mode
#+BEGIN_SRC emacs-lisp
  (use-package whitespace :hook ((prog-mode text-mode) . whitespace-mode)
    :init
	   (setq whitespace-style (quote (face spaces tabs newline space-mark tab-mark newline-mark )))
	   (setq whitespace-display-mappings
	  '(
	    (space-mark 32 [183] [46])
	    (newline-mark 10 [182 10])
	    (tab-mark 9 [9655 9] [92 9])
	    ))
	   )
#+END_SRC
** IDE stuff
*** Auto Insert File Header
#+BEGIN_SRC emacs-lisp
 (use-package autoinsert :ensure t 
  :init 
  (setq auto-insert-query nil)
  (auto-insert-mode 1))
#+END_SRC
*** Syntax Checker
#+BEGIN_SRC emacs-lisp
(use-package flycheck  :hook ((python-mode go-mode php-mode emacs-lisp-mode) . flycheck-mode))
#+END_SRC
*** Debugger Support
#+BEGIN_SRC emacs-lisp
(use-package dap-mode  :defer t :hook ((go-mode python-mode php-mode) . dap-mode))
#+END_SRC
*** Version Controll
#+BEGIN_SRC emacs-lisp
  (use-package magit  :commands (magit-status) :bind (("C-x g" . magit-status)))
  (use-package diff-hl  :config (global-diff-hl-mode))
#+END_SRC
*** Language Server protocol Support
#+BEGIN_SRC emacs-lisp
(use-package lsp-mode  :defer t)
(use-package lsp-ui  :defer t)
#+END_SRC
*** Completion Framework
#+BEGIN_SRC emacs-lisp
(use-package company-lsp  :defer t)
(use-package company 
  :config
  (setq company-tooltip-limit 30)
  (setq company-idle-delay .1)
  (setq company-echo-delay 0)
  (global-company-mode))
#+END_SRC
** Go setup
#+BEGIN_SRC emacs-lisp
  (use-package go-mode
    :mode "\\.go\\'"
    
    :config
	(lsp)
	(add-hook 'before-save-hook #'lsp-format-buffer t t)
	(add-hook 'before-save-hook #'lsp-organize-imports t t)
	(add-hook 'go-mode-hook 'go-eldoc-setup)
	(local-set-key (kbd "M-.") 'godef-jump)
	(local-set-key (kbd "M-*") 'pop-tag-mark)
	(add-to-list 'exec-path (concat (concat (getenv "HOME") "/go") "/bin")))

  (use-package go-add-tags  :defer t :config (global-set-key "C-c C-s" 'go-add-tags))
  (use-package gotest  :defer t :config (global-set-key (kbd "C-c C-t C-t") 'go-test-current-test) (global-set-key (kbd "C-c C-t C-f") 'go-test-current-file))
#+END_SRC
** Clojure setup
#+BEGIN_SRC emacs-lisp
(use-package clojure-mode  :defer t :mode "\\.cljs?\\'")
(use-package cider  :defer t :hook clojure-mode :config (cider-jack-in))
#+END_SRC
** Python Setup
*** Python Mode 
#+BEGIN_SRC emacs-lisp
(use-package python-mode
  :defer t
  :mode "\\.py\\'"
  :config
  (add-to-list 'exec-path (concat (getenv "HOME") "/.local/bin"))
  (lsp))
#+END_SRC
*** Pyhon Language Server
#+BEGIN_SRC emacs-lisp
(use-package lsp-python-ms
  
  :hook (python-mode . (lambda ()
                          (require 'lsp-python-ms)
                          (lsp)))) 
#+END_SRC
*** Autopep8 formatting
#+BEGIN_SRC emacs-lisp
(use-package py-autopep8  :defer t :hook python-mode)
#+END_SRC
** Elixir Setup
#+BEGIN_SRC emacs-lisp
(use-package elixir-mode  :mode "\\.ex\\'" :config (lsp))
(use-package alchemist  :defer t)
#+END_SRC
** Rust Setup
#+BEGIN_SRC emacs-lisp
(use-package rust-mode  :mode "\\.rs\\'" :init (add-hook 'rust-mode-hook #'lsp))
#+END_SRC
** Lisp Setup
*** Help us with parens
#+BEGIN_SRC emacs-lisp
  (use-package smartparens  :hook ((emacs-lisp-mode python-mode go-mode php-mode) . smartparens-mode))
  (use-package rainbow-delimiters  :hook ((emacs-lisp-mode python-mode go-mode php-mode) . rainbow-delimiters-mode))
#+END_SRC
** PHP Setup
#+BEGIN_SRC emacs-lisp
  (use-package php-mode  :defer :init (add-hook 'php-mode-hook #'lsp))
  (use-package phpunit  :defer t
    :bind (("C-c C-t t" . phpunit-current-test) ("C-c C-t c" . phpunit-current-class) ("C-c C-t p" . phpunit-current-project)))
#+END_SRC
** Javascript Setup
#+BEGIN_SRC emacs-lisp
(use-package js2-mode  :defer t :hook js-mode)
#+END_SRC
** Typescript Setup
#+BEGIN_SRC emacs-lisp
(use-package tide  :defer t :mode "\\.ts\\'")
#+END_SRC
** Some webish stuff
*** Web Mode
   #+BEGIN_SRC emacs-lisp
   (use-package web-mode  :defer t :mode ("\\.html\\'" "\\.css\\'"))
   #+END_SRC
** Devops Setup
#+BEGIN_SRC emacs-lisp
  (use-package kubel  :commands (kubel))
  (use-package dockerfile-mode :defer t :mode "Dockerfile")
  (use-package ansible :defer t :init (add-hook 'yaml-mode-hook (lambda () (ansible))))
#+END_SRC

** Database Client
*** truncate lines in SQL mode
#+BEGIN_SRC emacs-lisp
(add-hook 'sql-interactive-mode-hook
          (lambda ()
            (toggle-truncate-lines t)))
#+END_SRC
** Benchmark startup time
#+BEGIN_SRC emacs-lisp
(message "Startup Time %f" (- (float-time) start))
#+END_SRC
** Open my TODO file
#+BEGIN_SRC emacs-lisp
(find-file "~/.TODO.org")
#+END_SRC
