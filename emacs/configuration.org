* Amirreza Emacs Configuration
** Basic package manager and use-package setup
*** Store current time for further benchmark
#+BEGIN_SRC emacs-lisp
(setq start (float-time)) ;; to measure emacs startup time
#+END_SRC
*** Setup Emacs Package manager and add repos
#+BEGIN_SRC emacs-lisp
(require 'package)
(package-initialize) ;; initialize emacs built-in package manager
(setq package-archives '(("org"       . "http://orgmode.org/elpa/")
                         ("gnu"       . "http://elpa.gnu.org/packages/")
                         ("melpa"     . "https://melpa.org/packages/")
                         ("marmalade" . "http://marmalade-repo.org/packages/")))
#+END_SRC

*** Install use-package
#+BEGIN_SRC emacs-lisp
(package-install 'use-package)
(require 'use-package) ;; use-package helps us declaretively define our packages and lazy load them only when we need them.
(setq use-package-always-ensure t)
#+END_SRC

** Some Basic Emacs setup
*** setup custom file so emacs won't mess with init.el
#+BEGIN_SRC emacs-lisp 
(setq custom-file "~/.__custom.el")
#+END_SRC
*** Turn off emacs annoying and ugly startup page
#+BEGIN_SRC emacs-lisp
(setq inhibit-splash-screen 0) ;; turn off emacs annoying startup page.
#+END_SRC
*** Turn off Emacs annoying ~ files
#+BEGIN_SRC emacs-lisp
(setq make-backup-files nil) ;; turn off emacs annoying ~ files
#+END_SRC
*** Turn Emacs # files
#+BEGIN_SRC emacs-lisp
(setq create-lockfiles nil) ;; turn off emacs annoying # files
#+END_SRC

*** Turn Emacs annoying beeps
#+BEGIN_SRC emacs-lisp
(setq ring-bell-function 'ignore)
#+END_SRC
*** Turn off emacs GUI toolbar, menubar and scrollbar
#+BEGIN_SRC emacs-lisp
(tool-bar-mode 0) ;; turn off emacs GUI toolbar
(scroll-bar-mode 0) ;; turn off emacs GUI scrollbar
(menu-bar-mode 0) ;; turn emacs GUI menubar
#+END_SRC
*** Define alias for emacs question 
#+BEGIN_SRC emacs-lisp
(defalias 'yes-or-no-p 'y-or-n-p) ;; instead of yes-or-no ask y-or-no, only for convinience
#+END_SRC
*** Enable Line numbers globally
#+BEGIN_SRC emacs-lisp
(global-linum-mode t) ;; enable line numbers
#+END_SRC

** Some UI Enhancements and Theme setup
*** Prettify Lisp codes
#+BEGIN_SRC emacs-lisp
(defconst lisp--prettify-symbols-alist
  '(("lambda"  . ?Î»))) ;; shows lambda word as the symbol
(global-prettify-symbols-mode 1)
#+END_SRC
*** Font setup
#+BEGIN_SRC emacs-lisp
(defvar font-family "Jetbrains Mono" "Font to use for Emacs.")
(defvar font-size 11 "Font size for Emacs.")
(add-to-list 'default-frame-alist (cons 'font (format "%s-%d" font-family font-size)))
(set-face-attribute 'default nil
		    :family font-family
		    :height (* 10 font-size))
#+END_SRC
*** Themes Setup
#+BEGIN_SRC emacs-lisp 
(use-package dracula-theme :ensure t :defer t)
(use-package solarized-theme :ensure t :defer t)
(use-package spacemacs-theme :ensure t :defer t)
(use-package doom-themes :ensure t :defer t)

(defun light-it-up ()
  "Light the IDE up."
  (interactive)
  (load-theme 'spacemacs-light t))

(load-theme 'dracula t)
#+END_SRC
*** Show emojis
#+BEGIN_SRC emacs-lisp
(use-package emojify :ensure t :config (emojify-mode 1))
#+END_SRC
*** doom-modeline is really nice
#+BEGIN_SRC emacs-lisp 
;; (use-package doom-modeline :ensure t :config (doom-modeline-mode 1))
#+END_SRC
** Enhance emacs with Helm
*** Helm

#+BEGIN_SRC emacs-lisp
(use-package helm :ensure t 
    :bind (("M-x" . helm-M-x)
         ("M-y" . helm-show-kill-ring)
         ("C-x b" . helm-mini)
         ("C-x C-f" . helm-find-files)
         ("C-x r l" . helm-bookmarks)
         ("C-s" . helm-occur)
         :map helm-find-files-map ;; I like these from Ido
         ("C-<tab>"         . helm-execute-persistent-action)
         ("C-<backspace>" . helm-find-files-up-one-level))

    :config
    (helm-mode 1)
    (helm-flx-mode +1)
    (setq helm-M-x-fuzzy-match t)
    (setq helm-locate-fuzzy-match t)
    (setq helm-lisp-fuzzy-completion t)
    (setq helm-bookmark-show-location t)
    (setq helm-buffer-max-length 30))
(use-package flx :ensure t)
(use-package helm-flx :ensure t)
(use-package helm-projectile :ensure t
  :bind (("C-c v" . helm-projectile)
         ("C-c p" . helm-projectile-switch-project)))
(use-package helm-rg
    :bind
    (("C-c C-h C-s" . 'helm-rg)))
#+END_SRC
** Add support for various Markup languages
*** Make sure Org mode is installed :) and some Org related packages
#+BEGIN_SRC emacs-lisp
(use-package org :ensure t :defer t)
(use-package org-bullets :ensure t :defer t :init (lambda () (org-bullets-mode 1)))
#+END_SRC
*** Add Support for json, yaml and markdown
#+BEGIN_SRC emacs-lisp
(use-package json-mode :ensure t :mode "\\.json\\'"
  :config
  (add-hook 'before-save-hook 'json-mode-beautify))
(use-package markdown-mode :ensure t :mode "\\.md\\'")
(use-package yaml-mode :ensure t :mode "\\.ya?ml\\'")
#+END_SRC
** Keybindings
*** Some better keybindings for emacs internal actions
#+BEGIN_SRC emacs-lisp
(global-set-key (kbd "C-x -") 'split-window-vertically)
(global-set-key (kbd "C-x '") 'split-window-horizontally)
#+END_SRC
#+comment *** Vi is great editor so let's have that as well ...
#+BEGIN_SRC emacs-lisp
;; (use-package evil :ensure t :config (evil-mode t)) ;; Only for editing.
#+END_SRC
*** Which key helps us when we only remember part of a keybinding
#+BEGIN_SRC emacs-lisp 
(use-package which-key :ensure t :config (which-key-mode 1))
#+END_SRC
#+comment *** Help us a lot when using Vi Text Objects and motions
#+BEGIN_SRC emacs-lisp
;; (use-package linum-relative :ensure t :config (linum-relative-mode))
#+END_SRC

** IDE stuff
*** Syntax Checker
#+BEGIN_SRC emacs-lisp
(use-package flycheck :ensure t :hook ((python-mode go-mode php-mode emacs-lisp-mode) . flycheck-mode))
#+END_SRC
*** Debugger Support
#+BEGIN_SRC emacs-lisp
(use-package dap-mode :ensure t :defer t :hook ((go-mode python-mode php-mode) . dap-mode))
#+END_SRC
*** Git wrapper
#+BEGIN_SRC emacs-lisp 
(use-package magit :ensure t :defer t)
#+END_SRC
*** Language Server protocol Support
#+BEGIN_SRC emacs-lisp
(use-package lsp-mode :ensure t :defer t)
(use-package lsp-ui :ensure t :defer t)
#+END_SRC
*** Projectile 
Provides fuzzy file search and so much more in a project (git repo)
#+BEGIN_SRC emacs-lisp
(use-package projectile
  :config
  (projectile-mode)
  (setq-default projectile-mode-line
   '(:eval
     (if (file-remote-p default-directory)
         " Proj"
       (format " Proj[%s]" (projectile-project-name))))))

#+END_SRC
*** Completion Framework
#+BEGIN_SRC emacs-lisp
(use-package company-lsp :ensure t :defer t)
(use-package company
  :ensure t
  :config
  (setq company-tooltip-limit 30)
  (setq company-idle-delay .1)
  (setq company-echo-delay 0)
  (global-company-mode))
#+END_SRC
*** Engine Mode

**** A must have mode for every developer on the planet
#+BEGIN_SRC emacs-lisp
(use-package engine-mode :ensure t :config (engine-mode t))
#+END_SRC
**** defining engines
#+BEGIN_SRC emacs-lisp
(defengine stackoverflow
 "https://stackoverflow.com/search?q=%s")
(defengine github
 "https://github.com/search?ref=simplesearch&q=%s")
#+END_SRC
** Go setup
#+BEGIN_SRC emacs-lisp
(use-package go-mode
  :mode "\\.go\\'"
  :ensure t
  :init
  (add-hook 'go-mode-hook (lambda ()
			    (lsp)
			    (add-hook 'before-save-hook #'lsp-format-buffer t t)
			    (add-hook 'before-save-hook #'lsp-organize-imports t t)
			    (add-hook 'go-mode-hook 'go-eldoc-setup)))
  :config
  (add-to-list 'exec-path (concat (concat (getenv "HOME") "/go") "/bin")))

(use-package go-add-tags :ensure t :defer t :config (global-set-key "C-c C-s" 'go-add-tags))
(use-package gotest :ensure t :defer t :config (global-set-key (kbd "C-c C-t C-t") 'go-test-current-test) (global-set-key (kbd "C-c C-t C-f") 'go-test-current-file))
#+END_SRC
** Python Setup
*** Python Mode 
#+BEGIN_SRC emacs-lisp
(use-package python-mode
  :ensure t
  :defer t
  :mode "\\.py\\'"
  :config
  (add-to-list 'exec-path (concat (getenv "HOME") "/.local/bin"))
  (lsp))
#+END_SRC
*** Autopep8 formatting
#+BEGIN_SRC emacs-lisp
(use-package py-autopep8 :ensure t :defer t :hook python-mode)
#+END_SRC
** Lisp Setup
*** Help us with parens
#+BEGIN_SRC emacs-lisp
(use-package paredit :ensure t :hook (emacs-lisp-mode . paredit-mode))
(use-package parinfer :ensure t :hook (emacs-lisp-mode . parinfer-mode))
(use-package rainbow-delimiters :ensure :hook ((emacs-lisp-mode python-mode go-mode php-mode) . rainbow-delimiters-mode))
#+END_SRC
** Some webish stuff
*** PHP Setup
 #+BEGIN_SRC emacs-lisp
 (use-package php-mode :ensure t :defer :init (add-hook 'php-mode-hook #'lsp))
 #+END_SRC
*** Javascript/Typescript Setup
 #+BEGIN_SRC emacs-lisp
 (use-package js2-mode :ensure t :defer t :hook js-mode)
 (use-package tide :ensure t :defer t :mode "\\.ts\\'")
 #+END_SRC
** Devops Setup
#+BEGIN_SRC emacs-lisp
(use-package kubel :ensure t)
(use-package multi-term :ensure t :defer t)
(use-package docker :ensure t :defer t)
(use-package dockerfile-mode :ensure t :defer t)
(use-package ansible :ensure t :defer t :init (add-hook 'yaml-mode-hook (lambda () (ansible))))
;; (use-package kubernetes :ensure t :defer t)
#+END_SRC

** Benchmark startup time
#+BEGIN_SRC emacs-lisp
(message "Startup Time %f" (- (float-time) start))
#+END_SRC
