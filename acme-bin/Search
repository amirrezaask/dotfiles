#!/usr/bin/bash
# searches for every symbol in your source code, symbol types can be f , sc , i , v
# usage
# Search php/go sc/f/i/v SYMBOL

extension="$1"
query_type="$2"
query="$3"
query=".*$query.*"

# Add more languages :)

if [ "$extension" == 'go' ]; then
	f="func $query"
	sc="type $query struct"
	i="type $query interface"
	v="(var $query)|($query\s*:=)"
	extension_matched='1'
fi
if [ "$extension" = 'php' ]; then
	f="(?:public|private|protected)?\s*(?:static)? ($query)\(.*\)"
	sc="(?:public|private|protected)?\s*class\s*(.*$query.*)\s*\{"
	i="(?:public|private|protected)?\s*interface\s*($query)"
	v='(?:public|private)?\$'
	v+="($query)\s*=.*;$"
	extension_matched='1'
fi


if [ $extension_matched == '1' ]; then
	cmd="rg -i --vimgrep --smart-case"
	if [ $query_type == "f" ] || [ $query_type == "a" ]; then
		cmd+=" -e '$f'"
	fi

	if [ $query_type == "sc" ] || [ $query_type == "a" ]; then
		cmd+=" -e '$sc'"
	fi

	if [ $query_type == "i" ] || [ $query_type == "a" ]; then
		cmd+=" -e '$i'"
	fi

	if [ $query_type == "v" ] || [ $query_type == "a" ]; then
		cmd+=" -e '$v'"
	fi
	echo $cmd
	eval $cmd

fi
