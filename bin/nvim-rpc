#!/usr/bin/env python3
import msgpack
import socket
import sys

SOCKET_PATH = "/tmp/nvim-socket"

if len(sys.argv) < 2:
    print("Usage: nvim-rpc.py '<vim command>'")
    sys.exit(1)

command = sys.argv[1]

# connect to nvim socket
sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
sock.connect(SOCKET_PATH)

# msgpack request format: [type, msgid, method, params]
# type=0 → request, type=1 → response, type=2 → notification
request = [0, 1, "nvim_command", [command]]

sock.sendall(msgpack.packb(request))

# receive and decode response (optional)
response = sock.recv(1024)
if response:
    print("Response:", msgpack.unpackb(response, raw=False))
