#!/usr/bin/env bash

set -e

if [[ -z "$1" && "$1" != "CNCLD" ]]; then
  echo "Usage: theme-set <theme-name>" >&2
  exit 1
fi

THEME_NAME=$(echo "$1" | sed -E 's/<[^>]+>//g' | tr '[:upper:]' '[:lower:]' | tr ' ' '-')

THEMES_DIR="$HOME/.config/themes"

THEME_PATH="$THEMES_DIR/$THEME_NAME"

CURRENT_THEME_DIR="$HOME/.config/themes/current"
CURRENT_BACKGROUND="$HOME/.config/current-background"

unlink $THEMES_DIR/current
ln -nsf $THEME_PATH $CURRENT_THEME_DIR
echo "Inja"

notify-send "Theme changed to $THEME_NAME" -t 2000

touch "$HOME/.config/alacritty/alacritty.toml"

unlink $HOME/.config/nvim/lua/plugins/theme.lua; ln -s $THEMES_DIR/current/neovim.lua ~/.config/nvim/lua/plugins/theme.lua

unlink $HOME/.config/btop/themes/current.theme; ln -nsf $THEMES_DIR/current/btop.theme $HOME/.config/btop/themes/current.theme

echo "Links setup done"

if [[ -f ~/.config/themes/current/light.mode ]]; then
	light-mode
else
	dark-mode
fi

echo "Colorscheme setup done"

hyprctl reload

restart-app waybar

restart-swaybg

theme-bg-next
