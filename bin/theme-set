#!/usr/bin/env bash

set -e

if [[ -z "$1" && "$1" != "CNCLD" ]]; then
  echo "Usage: theme-set <theme-name>" >&2
  exit 1
fi

THEME_NAME=$(echo "$1" | sed -E 's/<[^>]+>//g' | tr '[:upper:]' '[:lower:]' | tr ' ' '-')

THEMES_DIR="$HOME/.config/themes"

THEME_PATH="$THEMES_DIR/$THEME_NAME"

CURRENT_THEME_DIR="$HOME/.config/themes/current"
CURRENT_BACKGROUND="$HOME/.config/current-background"

unlink $THEMES_DIR/current
ln -nsf $THEME_PATH $CURRENT_THEME_DIR

NEW_BACKGROUND_PATH=$THEMES_DIR/current/backgrounds/$(ls $THEMES_DIR/current/backgrounds/ | head -n 1)
echo $NEW_BACKGROUND_PATH
ln -nsf $NEW_BACKGROUND_PATH $CURRENT_BACKGROUND

notify-send "Theme changed to $THEME_NAME" -t 2000

hyprctl reload

restart-app waybar

restart-swaybg

unlink ~/.config/nvim/lua/plugins/theme.lua; ln -s $THEMES_DIR/current/neovim.lua ~/.config/nvim/lua/plugins/theme.lua

unlink $HOME/.config/btop/themes/current; ln -nsf $THEMES_DIR/current/btop.theme $HOME/.config/btop/themes/current.theme

gsettings set org.gnome.desktop.interface color-scheme 'prefer-dark'

touch ~/.config/alacritty/alacritty.toml

kitty @ load-config
